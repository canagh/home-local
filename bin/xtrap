#!/bin/sh

wait=1s # for sleep(1)
number=1 # the number of the windows to trap

# option
while [ "$1" ] ; do
    case $1 in
        -h | --help ) echo $(basename "$0")' [-w|--wait] [-n|--number] [--] [WINDOWID]...' ; exit ;;
        -w ) wait="$2" ; shift 2 ;;
        -n | --number ) number="$2" ; shift 2 ;;
        -- ) shift ; break ;;
        -* ) $(basename "$0")': unknown option: '"$1" >&2 ; exit 1 ;;
        * ) break ;;
    esac
done

if [ $# -eq 0 ] ; then
    wids=
    for i in $(seq "$number"); do
        id=$(xprop | grep 'window id' | sed -e 's/^.*\(0x[[:xdigit:]]\+\).*$/\1/')
        echo "$id"
        xprop -id "$id"
        wids="$wids"\ "$id"
        echo
    done
else
    for arg in "$@"; do
        # show and validate the windows
        echo "$arg"
        xprop -id "$arg" \
            || echo $(basename "$0")': wrong argument (a window id required): '"$arg" >&2 && exit 1
        echo
    done
    wids="$*"
fi

while true; do
    for wid in $wids; do
        # xprop returns exit code 1, when the id is wrong
        xprop -id $wid >/dev/null 2>&1 || exit 0
    done
    sleep "$wait"
done
