#!/bin/bash

opts=()

src=
while [[ $# != 0 ]] ; do
    case "$1" in
        -[WFv]  ) opts=("${opts[@]}" "$1" "$2") ; shift ;;
        -[WFv]* ) opts=("${opts[@]}" "$1") ;;
        -b* | --begin* | begin )
            case "$1" in
                -b?* )      block="`echo "$1" | tail -c +3`" ;;
                --begin=* ) block="`echo "$1" | tail -c +9`" ;;
                -b | --begin | begin ) block="$2" ; shift ;;
            esac
            src="$src"' BEGIN { '"$block"' } '
            ;;
        * )
            # env like
            # if [[ "$1" =~ ^[[:alnum:]]\+= ]] ; then
            # fi
        -- ) break ;;
    esac
    shift
done

exec awk "${opts[@]}" -- "$src" "$@"
