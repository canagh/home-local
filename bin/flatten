#!/bin/sh

while [ "$1" ]; do
    case "$1" in
        -h | --help )
            echo 'Usage: '`basename "$0"`' PATH..'
            echo 'Flatten duplicated directories (to extract compressed files often makes them).'
            echo 'i.e. move foo/foo/foo/* -> foo/* and remove foo/{foo/foo,foo}'
            exit
            ;;
        -* )
            echo `basename "$0"`': unknown option: '\`"$1"\' 1>&2
            exit 1
            ;;
        * )
            break
            ;;
    esac
done

if [ ! "$1" ]; then
    echo `basename "$0"`': missing arguments' 1>&2
    exit 1
fi
while [ "$1" ]; do
    base=`basename "$1"`
    push() {
        [ -d "$1"/"$base"/"$base" ] && push "$1"/"$base"
        mv -t "$1" "$1"/"$base"/*
        rmdir "$1"/"$base"
    }
    [ -d "$1"/"$base" ] && push "$1"
    shift
done
